// Generated by CoffeeScript 1.6.3
var Serializer, Writer;

Writer = require('./writer');

Serializer = (function() {
  function Serializer() {
    this.writer = new Writer();
  }

  Serializer.prototype.stringifyPrimitive = function(key, value) {
    this.writer.startElement(key);
    if (typeof value === 'object') {
      value = value.valueOf();
    }
    if (typeof value === 'object') {
      this.stringifyObject(value);
    } else {
      this.writer.pushText(value);
    }
    this.writer.endElement(key);
    return this;
  };

  Serializer.prototype.stringifyArray = function(key, data) {
    var value, _i, _len;
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      value = data[_i];
      this.stringifyAny(key, value);
    }
    return this;
  };

  Serializer.prototype.stringifyObject = function(data) {
    var key, value;
    for (key in data) {
      value = data[key];
      if (key[0] !== '$' && (value != null)) {
        this.stringifyAny(key, value);
      }
    }
    return this;
  };

  Serializer.prototype.stringifyAny = function(key, value) {
    if (Array.isArray(value)) {
      this.stringifyArray(key, value);
    } else {
      this.stringifyPrimitive(key, value);
    }
    return this;
  };

  Serializer.prototype.run = function(data) {
    this.stringifyObject(data);
    return this.writer.buffer.join('');
  };

  return Serializer;

})();

module.exports = Serializer;
